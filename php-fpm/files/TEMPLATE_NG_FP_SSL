#####
#
upstream fpm[PORT] {
    server 127.0.0.1:[PORT];
}

server {
    include         /etc/nginx/include.d/listen.conf;
    server_name     [DOMAIN]
                    www.[DOMAIN];

    # Log files
    access_log      [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-access.log combined buffer=128k;
    error_log       [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-error.log;
    
    return          301 https://[DOMAIN]$request_uri;
}

server {
    include         /etc/nginx/include.d/listen_ssl.conf;
    server_name     [DOMAIN];

    # Load configuration files for the default server block.
    include         /etc/nginx/default.d/*.conf;
    # Log files
    access_log      [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-access.log combined buffer=128k;
    error_log       [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-error.log;
    
    ssl_certificate         /etc/pki/tls/certs/[DOMAIN].crt;
    ssl_certificate_key     /etc/pki/tls/private/[DOMAIN].key;
    include                 /etc/nginx/include.d/ssl_common.conf;

    set $root_path  '[BASEDIR]/[USER]/[WEBROOT]';
    set $fpmport    [PORT];

    root            $root_path;
    index           index.php;

    include         /etc/nginx/include.d/fpm.conf;
}

server {
    include         /etc/nginx/include.d/listen_ssl.conf;
    server_name     www.[DOMAIN];

    # Log files
    access_log      [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-access.log combined buffer=128k;
    error_log       [BASEDIR]/[USER]/log/[SUBDOMAIN]nginx-error.log;
    
    ssl_certificate         /etc/pki/tls/certs/[DOMAIN].crt;
    ssl_certificate_key     /etc/pki/tls/private/[DOMAIN].key;
    include                 /etc/nginx/include.d/ssl_common.conf;

    return          301 https://[DOMAIN]$request_uri;
}
