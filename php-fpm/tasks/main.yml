---
- name: Check if role assigned to host
  fail:
    msg: "ROLE 'php-fpm' IS NOT ASSIGNED TO THIS HOST"
  when: "'php-fpm' not in roles"

- import_tasks: packages.yml

- name: "Copy index.php"
  copy:
    dest: /var/www
    src: index.php
    force: yes
  tags: [ index ]

# UMASK
- name: "Set umask for php-fpm service"
  blockinfile:
    dest: /etc/systemd/system/php-fpm.service.d/php-fpm.conf
    create: yes
    marker: "# {mark} ANSIBLE MANAGED BLOCK: UMASK"
    block: |
      [Service]
      UMask=0002
  notify: config restart php-fpm
  tags: [ services ]

- name: Set ini ondemand for default pool
  ini_file:
    path: "/etc/php-fpm.d/www.conf"
    section: www
    option: pm
    value: ondemand
  notify: config reload php-fpm

- include_tasks: logrotate.yml

- include_tasks: awstats.yml
...
