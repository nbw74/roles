---
- name: create git repo
  command: "sg {{ vhost_git_group }} -c 'git init --bare --shared {{ vhost_git_path }}/{{ item.repo.name|d(item.name) }}'"
  args:
    creates: "{{ vhost_git_path }}/{{ item.repo.name|d(item.name) }}/HEAD"
  when:
    - item.repo is defined
    - item.repo.type|d('none') == 'git'
    - item.state|d(true)
  with_items: "{{ vhost }}"
  delegate_to: "{{ vhost_git_server }}"
  notify: repo git created
  tags: [ repo ]
...
