---
- name: PostgreSQL repo
  yum_repository:
    name: "pgdg{{ postgresql_version_norm }}"
    description: "PostgreSQL {{ postgresql_version_raw }} $releasever - $basearch"
    baseurl: "https://download.postgresql.org/pub/repos/yum/{{ postgresql_version_raw }}/redhat/rhel-$releasever-$basearch"
    file: "pgdg-{{ postgresql_version_norm }}-centos"
    gpgcheck: yes
    enabled: yes
    gpgkey: "http://ftp.postgresql.org/pub/repos/yum/RPM-GPG-KEY-PGDG-{{ postgresql_version_norm }}"

- name: PostgreSQL packages
  yum:
    name: "postgresql{{ postgresql_version_norm }}{{ item }}"
    state: present
  with_items:
    - ""
    - "-server"
    - "-contrib"

- name: Pacemaker packages
  yum:
    name: "{{ postgresql_pcmk_packages }}"
    state: present
  when: postgresql_pcmk_enable
  tags: [ packages ]

- name: Pacemaker rmlock packages
  yum:
    name: "{{ postgresql_pcmk_rmlock_packages }}"
    state: present
  when:
    - postgresql_pcmk_enable
    - postgresql_pcmk_rmlock_enable
  tags: [ packages ]

- name: Additional packages
  yum:
    name: "{{ postgresql_additional_packages }}"
    state: present
  when: postgresql_additional_packages is defined
  tags: [ packages ]
...
